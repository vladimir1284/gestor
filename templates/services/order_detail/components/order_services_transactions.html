{% load static %}
<div class="table-responsive text-nowrap">
    <table class="table table-sm">
        <thead>
            <tr>
                <th>
                    <i class="bx bx-cog"></i>
                </th>
                <th>Service</th>
                <th class="text-center">Qty</th>
                <th class="text-center">Price</th>
                <th class="text-center">Amount</th>
                <th class="text-center">Tax</th>
                <th class="text-end">Actions</th>
            </tr>
        </thead>
        <tbody class="table-border-bottom-0" @click.outside="editNothing()">
            <template x-for="transaction in transactions">
                <tr :data-tag="transaction.name"
                    :class="{
                            'bg-red-100': transaction.decline,
                            'highlight': transaction.id == selected.id,
                            }">
                    <!-- x-effect="if (transaction.id == selected.id) { -->
                    <!--           scrollTo($el) -->
                    <!--           }"> -->
                    <td>
                        <a :href="transactionUrl(transaction.id)">
                            $<span x-text="getTotalPrice(transaction).toFixed(2)"></span>
                        </a>
                    </td>
                    <td>
                        <strong x-text="transaction.service.name"></strong>
                    </td>
                    <td @click="editQuantity(transaction.id)" class="text-center">
                        <template x-if="editingQuantity(transaction.id)">
                            <div class="flex">
                                <button class="btn btn-icon btn-link" @click="decEditingField(1, 1)">
                                    <i class='bx bx-minus' ></i>
                                </button>
                                <div class="input-group">
                                    <input type="number" min="1" class="form-control !p-1 !w-20 text-center" x-model="selected.ref.quantity" @keyup.enter="editNothing()" x-init="$el.focus()">
                                </div>
                                <button class="btn btn-icon btn-link" @click="incEditingField(1)">
                                    <i class='bx bx-plus' ></i>
                                </button>
                            </div>
                        </template>
                        <template x-if="!editingQuantity(transaction.id)">
                            <strong class="text-primary">
                                <span x-text="transaction.quantity"></span>
                            </strong>
                        </template>
                    </td>
                    <td @click="editPrice(transaction.id)" class="text-center">
                        <template x-if="editingPrice(transaction.id)">
                            <div class="flex">
                                <button class="btn btn-icon btn-link" @click="decEditingField(1, 0)">
                                    <i class='bx bx-minus' ></i>
                                </button>
                                <div class="input-group">
                                    <input type="number" min="0" class="form-control !p-1 !w-20 text-center" x-model="selected.ref.price" @keyup.enter="editNothing()" x-init="$el.focus()">
                                </div>
                                <button class="btn btn-icon btn-link" @click="incEditingField(1)">
                                    <i class='bx bx-plus' ></i>
                                </button>
                            </div>
                        </template>
                        <template x-if="!editingPrice(transaction.id)">
                            <strong class="text-primary">
                                $<span x-text="transaction.price.toFixed(2)"></span>
                            </strong>
                        </template>
                    </td>
                    <td class="text-center">
                        $<span x-text="getAmount(transaction).toFixed(2)"></span>
                    </td>
                    <td @click="editTax(transaction.id)" class="text-center">
                        <template x-if="editingTax(transaction.id)">
                            <div class="flex">
                                <button class="btn btn-icon btn-link" @click="decEditingField(1, 0)">
                                    <i class='bx bx-minus' ></i>
                                </button>
                                <div class="input-group">
                                    <input type="number" min="0" class="form-control !p-1 !w-20 text-center" x-model="selected.ref.tax" @keyup.enter="editNothing()" x-init="$el.focus()">
                                </div>
                                <button class="btn btn-icon btn-link" @click="incEditingField(1)">
                                    <i class='bx bx-plus' ></i>
                                </button>
                            </div>
                        </template>
                        <template x-if="!editingTax(transaction.id)">
                            <strong class="text-primary">
                                $<span x-text="getTax(transaction).toFixed(2)"></span>
                            </strong>
                        </template>
                    </td>
                    <td class="flex justify-end">
                        <button class="btn btn-icon btn-link text-danger"
                                @click="remove(transaction.id)">
                            <i class='bx bx-trash'></i>
                        </button>
                    </td>
                </tr>
            </template>
        </tbody>
    </table>
</div>
