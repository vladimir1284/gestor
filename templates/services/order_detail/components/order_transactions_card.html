{%load static%}

<style>
  .loader, .loader:before, .loader:after {
    border-radius: 50%;
    width: 2.5em;
    height: 2.5em;
    animation-fill-mode: both;
    animation: bblFadInOut 1.8s infinite ease-in-out;
  }
  .loader {
    color: #06F;
    font-size: 7px;
    position: relative;
    text-indent: -9999em;
    transform: translateZ(0);
    animation-delay: -0.16s;
  }
  .loader:before,
  .loader:after {
    content: '';
    position: absolute;
    top: 0;
  }
  .loader:before {
    left: -3.5em;
    animation-delay: -0.32s;
  }
  .loader:after {
    left: 3.5em;
  }

  @keyframes bblFadInOut {
    0%, 80%, 100% { box-shadow: 0 2.5em 0 -1.3em }
    40% { box-shadow: 0 2.5em 0 0 }
  }

  .highlight {
    box-shadow: inset 0 0 10px rgba(0, 50, 255, 0.5);
  }
</style>

<div class="fixed top-0 left-0 right-0 bottom-0 z-[1100] bg-[rgba(0,0,0,0.4)]" style="backdrop-filter: blur(5px);" x-show="showRemoveDialog()" x-cloak>
  <div class="">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Remove this <span x-text="transactionType"></span>?</h5>
          <button type="button" class="btn-close absolute right-0 top-0 m-0 shadow-sm bg-white rounded p-2" @click="removeCancel()"></button>
        </div>

        <div class="modal-body">
          <div>
            Are you sure to remove this <span x-text="transactionType"></span>?
          </div>
          <div>
            <span x-text="titleTransactionType()"></span> to remove: <strong x-text='getToRemoveName()'></strong>
          </div>
        </div>

        <div>
          <div class="flex justify-center" x-show="removing">
            <span class="loader"></span>
          </div>
          <div x-show="!removing">
            <div class="modal-footer">
              <button type="button" class="btn btn-outline-primary" @click="removeCancel()">Cancel</button>
              <button type="button" class="btn btn-danger" @click="doRemove()">Remove</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div :class="newProductMode() && 'fixed top-0 left-0 right-0 bottom-0 z-[1100] bg-[rgba(0,0,0,0.4)] py-4 sm:px-4 lg:px-20 xl:px-40'" style="backdrop-filter: blur(5px);">
  <div class="card mb-3 transition-all h-full partsCard" @click.outside="closeNewProductMode()">
    <div class="card-header flex items-center">
      <h5 class="flex-grow m-0 p-0" x-show="!newProductMode()">
        <span x-text="titleTransactionType()"></span>:

        <strong>
          $<span x-text="satisfied_args.total.toFixed(2)"></span>
        </strong>
        =
        <span>
          $<span x-text="satisfied_args.amount.toFixed(2)"></span>
        </span>
        +
        <span>
          $<span x-text="satisfied_args.tax.toFixed(2)"></span>
        </span>
      </h5>
      <div class="flex transition-all" :class="newProductMode() && 'w-full'">
        {%if not terminated%}
          <div class="input-group mb-3">
            <span class="input-group-text" id="basic-addon1">
              <i class='bx bx-search-alt-2' ></i>
            </span>
            <input type="text"
                   class="form-control transition-all"
                   :placeholder="`(${shortcut.toUpperCase()}) Add a new ${transactionType}`"
                   @keyup.escape="newProductSearch = ''"
                   @focus="searchProductInputFocus = true"
                   x-model="newProductSearch"
                   x-ref="searchProducts">
            <span class="input-group-text text-danger"
                  id="close"
                  x-show="newProductMode()"
                  @click="closeNewProductMode()"
            >
              <i class='bx bx-x'></i>
            </span>
          </div>
        {% endif %}
      </div>
    </div>
    <div class="h-full" x-show="newProductMode()">
      <div class="flex justify-center items-center w-96 h-12" x-show="loadingProducts">
        <span class="loader"></span>
      </div>
      <div x-show="!loadingProducts">
        {% include "./order_products.html" %}
      </div>
    </div>
    <div x-show="!newProductMode()">
      <div class="flex justify-center items-center w-96 h-12" x-show="loading">
        <span class="loader"></span>
      </div>
      <div x-show="!loading">
        {% include "./order_transactions.html" %}
      </div>
    </div>
  </div>
</div>

<script>
  globalThis.OrderID = {{order.id}}
  globalThis.UpdateTransUrl = "{% url 'update-transaction' 0 %}"
  globalThis.DetailTransUrl = "{% url 'detail-transaction' 0 %}"
  globalThis.DetailProductUrl = "{% url 'detail-product' 0 %}"
  {% if terminated %}
    globalThis.Terminated = true
  {% else %}
    globalThis.Terminated = false
  {% endif %}
</script>
<script src="{% static "assets/js/orders/config/get_cookies.js" %}"></script>

<script src="{% static "assets/js/orders/config/product_transaction_urls.js" %}"></script>
<script src="{% static "assets/js/orders/config/product_urls.js" %}"></script>

<script src="{% static "assets/js/orders/api/product_api_client.js" %}"></script>
<script src="{% static "assets/js/orders/api/product_transaction_api_client.js" %}"></script>

<script src="{% static "assets/js/orders/controllers/order_controller.js" %}"></script>
