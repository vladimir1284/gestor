{% load static %}
{% load nbsp %}
<head>
    <meta charset="utf-8" />
    <!-- Core CSS -->
    <link rel="stylesheet"
          href="{% static 'assets/vendor/css/core.css' %}"
          class="template-customizer-core-css" />
    <link rel="stylesheet"
          href="{% static 'assets/vendor/fonts/boxicons.css' %}" />
    <link rel="stylesheet"
          href="{% static 'assets/css/style.css' %}"/>
    <style>
        @page {
            size: A3;
            margin: 20mm;
        }
        body{
            background-color: white;
        }
        h6 {
            font-size: 2rem;
        }
        .invoice-descrpition{
            width: 100%;
        }
        td {
            padding-right: 0.3cm;
            padding-bottom: 0.3cm;
        }
        #qrcode svg {
            width: 5cm;
            height: 5cm;
            display
        }
        #qrcode {
            max-width: 5.5cm;
            width: 5.5cm !important;
        }

        #logo {
            width: 100px;
            z-index: 100;
        }

        {%if pdf%}
            #logo {
                position: absolute;
                top: 10px;
                right: 40px;
            }

            .text-primary {
                color: #0069FF;
                font-weight: bold;
            }
            .text-success {
                font-weight: bold;
            }
            .text-warning {
                color: #FFBB00;
                font-weight: bold;
            }
            .text-danger {
                color: #FF1100;
                font-weight: bold;
            }
        {%else%}
            .card {
                margin-bottom: 1rem;
            }
        {%endif%}
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <div class="card-header mb-2 flex">
                <div class="flex-grow">
                    <h1>Invoice:</h1>
                    <table class="mx-4">
                        <tbody>
                            <tr>
                                <td>
                                    <strong>Date</strong>
                                </td>
                                <td>
                                    {% now "E, d Y" %}
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <strong>Invoice number</strong>
                                </td>
                                <td>
                                    {{ devolution.invoice_number }}
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div>
                    <img id="logo"
                         src="{% static 'assets/img/icons/TOWIT.png' %}"
                         alt=""/>
                </div>
            </div>

            <div class="card-body pb-0 mb-0">
                <table class="mx-4">
                    <tbody>
                        <tr>
                            <td class="pt-0 pb-1 invoice-descrpition">
                                <strong>TOWIT HOUSTON LLC</strong>
                            </td>
                            <td>
                                <strong>BILL TO</strong>
                            </td>
                        </tr>
                        <tr>
                            <td>6011 Liberty Rd</td>
                            <td></td>
                        </tr>
                        <tr>
                            <td>Houston, TX 77026</td>
                            <td>
                                {{ devolution.contract.lessee.name|nbsp }}
                            </td>
                        </tr>
                        <tr>
                            <td>(832) 963-5145 / (305) 833-6144</td>
                            <td>{{ devolution.contract.lessee.phone_number|nbsp }}</td>
                        </tr>
                        <tr>
                            <td>info@towithouston.com</td>
                            <td>{{ devolution.contract.lessee.email|nbsp }}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h2 class="mb-0">
                    Security Deposit -
                    {% if original %}
                        {% if discount.init_state %}
                            {% if discount.should_return and devolution.debt_amount == 0 %}
                                <span>Returned</span>:
                            {% else %}
                                <span>Towit Compensation</span>:
                            {% endif %}
                        {% else %}
                            <span>Pending Return</span>:
                        {% endif %}
                    {% else %}
                        {% if devolution.returned %}
                            {% if discount.should_return and devolution.debt_amount == 0 %}
                                <span>Returned</span>:
                            {% else %}
                                <span>Towit Compensation</span>:
                            {% endif %}
                        {% else %}
                            <span>Pending Return</span>:
                        {% endif %}
                    {% endif %}
                </h2>
            </div>
            <div class="card-body">
                <div class="m-auto flex flex-wrap">
                    <table>
                        <tbody>
                            <tr>
                                <td>
                                    <span>
                                        {% if discount.duration %}
                                            <i class='bx bx-check-circle'></i>
                                        {% else %}
                                            <i class='bx bx-x-circle' ></i>
                                        {% endif %}
                                    </span>
                                    <span>
                                        Duration:
                                    </span>
                                </td>
                                <td class="text-right">
                                    {{discount.expirate_HTML|safe}}
                                </td>
                            </tr>
                            <tr>
                                <td class="align-top">
                                    <span>
                                        {% if discount.location_towit %}
                                            <i class='bx bx-check-circle'></i>
                                        {% else %}
                                            <i class='bx bx-x-circle' ></i>
                                        {% endif %}
                                    </span>
                                    <span>
                                        Return location:
                                    </span>
                                </td>
                                <td class="text-right">
                                    {% if discount.location_towit %}
                                        Returned at Towit Houston location.
                                    {% else %}
                                        Not returned at Towit Houston location.
                                        {% if discount.location_note is not None %}
                                            <div>
                                                {{discount.location_note}}
                                            </div>
                                        {% endif %}
                                    {% endif %}
                                </td>
                            </tr>
                            <tr class="border-t">
                                <td>Return date:</td>
                                <td class="text-right">
                                    {% if original %}
                                        {% if discount.init_state%}
                                            {{devolution.returned_date|date:"E d, Y"}}
                                        {% else %}
                                            {{devolution.refund_date|date:"E d, Y"}}
                                        {% endif %}
                                    {% else %}
                                        {% if devolution.returned %}
                                            {{devolution.returned_date|date:"E d, Y"}}
                                        {% else %}
                                            {{devolution.refund_date|date:"E d, Y"}}
                                        {% endif %}
                                    {% endif %}
                                </td>
                            </tr>
                            <tr class="border-t">
                                <td>Total deposited:</td>
                                <td class="text-right">
                                    <strong>+ ${{devolution.total_deposited_amount | floatformat:'-2'}}</strong>
                                </td>
                            </tr>
                            <tr>
                                <td>Prepayments:</td>
                                <td class="text-right">
                                    <strong>+ ${{devolution.prepayments | floatformat:'-2'}}</strong>
                                </td>
                            </tr>
                            <tr>
                                <td>Debts:</td>
                                <td class="text-right">
                                    <strong>- ${{devolution.debts | floatformat:'-2'}}</strong>
                                </td>
                            </tr>
                            <tr>
                                <td>Tolls:</td>
                                <td class="text-right">
                                    {% if original %}
                                        <strong>- ${{devolution.original_tolls | floatformat:'-2'}}</strong>
                                    {% else %}
                                        <strong>- ${{devolution.tolls | floatformat:'-2'}}</strong>
                                    {% endif %}
                                </td>
                            </tr>
                            <tr class="border-b">
                                <td>Trailer condition discount:</td>
                                <td class="text-right">
                                    <strong>- ${{devolution.trailer_discount | floatformat:'-2'}}</strong>
                                </td>
                            </tr>
                            {%if devolution.amount >= 0%}
                                <tr>
                                    <td>
                                        {% if devolution.returned %}
                                            Returned to client:
                                        {% else %}
                                            To return to client:
                                        {% endif %}
                                    </td>
                                    <td class="text-right">
                                        {% if original %}
                                            <strong>${{ devolution.original_returned_amount | floatformat:'-2' }}</strong>
                                        {% else %}
                                            <strong>${{ devolution.returned_amount | floatformat:'-2' }}</strong>
                                        {% endif %}
                                    </td>
                                </tr>
                            {%else%}
                                <tr>
                                    <td>Total client debt:</td>
                                    <td class="text-right">
                                        {% if original %}
                                            <strong>${{ devolution.original_debt_amount|floatformat:'-2' }}</strong>
                                        {% else %}
                                            <strong>${{ devolution.debt_amount|floatformat:'-2' }}</strong>
                                        {% endif %}
                                    </td>
                                </tr>
                            {%endif%}
                            <tr>
                                <td>Towit compensation:</td>
                                <td class="text-right">
                                    {% if original %}
                                        <strong>${{ devolution.original_income|floatformat:'-2' }}</strong>
                                    {% else %}
                                        <strong>${{ devolution.income|floatformat:'-2' }}</strong>
                                    {% endif %}
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>


        {%if not original%}
            <div class="card">
                <div class="card-header">
                    <h3 class="mb-0">
                        After contract ends tolls:
                    </h3>
                </div>
                <div class="table-responsive text-nowrap">
                    <div class="container ps-0 max-h-96 overflow-auto">
                        <table class="table">
                            <thead class="sticky top-0 bg-white">
                                <tr>
                                    <th>Invoice Number</th>
                                    <th>Date</th>
                                    <th>Amount</th>
                                </tr>
                            </thead>
                            <tbody class="table-border-bottom-0">
                                {% for toll in devolution.extra_tolls_list %}
                                    <tr>
                                        <td>
                                            {{toll.invoice_number}}
                                        </td>
                                        <td>
                                            {{toll.created_date|date:'E d, Y'}}
                                        </td>
                                        <td>
                                            <strong>
                                                ${{toll.amount|floatformat:'-2'}}
                                            </strong>
                                        </td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        {% endif %}
    </div>
</body>
